                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  CREATE OR REPLACE EDITIONABLE TRIGGER ETUDIANT_INFO_INSERT_TRIGGER                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
INSTEAD OF INSERT ON Etudiant_Info_insertion                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
FOR EACH ROW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
DECLARE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    v_id_etudiant INT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    v_id_ia INT;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    -- Get next sequence value for ID_ETUDIANT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
    SELECT SEQ_ETUDIANT.NEXTVAL INTO v_id_etudiant FROM DUAL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- Insert into Etudiant table                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    INSERT INTO Etudiant (ID_ETUDIANT, NOM, PRENOM, D_NAISS, SEXE, TELE, EMAIL, PASSWORD, NATIONALITE, CIN, MASSAR)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
    VALUES (v_id_etudiant, :NEW.NOM, :NEW.PRENOM, :NEW.D_NAISS, :NEW.SEXE, :NEW.TELE, :NEW.EMAIL, :NEW.PASSWORD, :NEW.NATIONALITE, :NEW.CIN, :NEW.MASSAR);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- Get next sequence value for ID_IA                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    SELECT SEQ_INFO_ACAD.NEXTVAL INTO v_id_ia FROM DUAL;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
    -- Insert into Info_academique table                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
    INSERT INTO Info_academique (ID_IA, D_LICENCE, D_BAC, FIL_BAC, MOY_LICENCE, MOY_BAC, N_S1, N_S2, N_S3, N_S4, N_S5, N_S6, PHOTO, ID_FIL_LICENCE, ID_ETUDIANT, ID_FACULTE,d_pr_inscription)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
    VALUES (v_id_ia, :NEW.D_LICENCE, :NEW.D_BAC, :NEW.FIL_BAC, :NEW.MOY_LICENCE, :NEW.MOY_BAC, :NEW.N_S1, :NEW.N_S2, :NEW.N_S3, :NEW.N_S4, :NEW.N_S5, :NEW.N_S6, :NEW.PHOTO, :NEW.ID_FIL_LICENCE, v_id_etudiant, :NEW.ID_FACULTE, :NEW.d_pr_inscription);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
ALTER TRIGGER ETUDIANT_INFO_INSERT_TRIGGER ENABLE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        


--compilation errors
--   CREATE OR REPLACE EDITIONABLE TRIGGER ETUD_V_T INSTEAD OF INSERT ON etudiant_v                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
-- FOR EACH ROW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
-- BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
--   INSERT INTO etudiant VALUES(etudiant_seq.NEXTVAL, :NEW.nom, :NEW.prenom, :NEW.D_Naiss, :NEW.sexe, :NEW.tele, :NEW.email, :NEW.password, :NEW.nationalite, :NEW.cin, :NEW.massar);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
-- END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
-- /                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
-- ALTER TRIGGER ETUD_V_T ENABLE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
 --compilation errors                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
--   CREATE OR REPLACE EDITIONABLE TRIGGER INFO_ACCADEMIQUE_V_T INSTEAD OF                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
-- INSERT ON info_accademique_v                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
-- FOR EACH ROW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
-- BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
--   INSERT INTO info_accademique  VALUES (info_accademique_seq.NEXTVAL, :NEW.d_graduation, :NEW.d_bac, :NEW.fil_bac, :NEW.moy_licence, :NEW.moy_bac, :NEW.n_s1, :NEW.n_s2, :NEW.n_s3, :NEW.n_s4, :NEW.n_s5, :NEW.n_s6, :NEW.photo, :NEW.id_fil_licence, :NEW.id_etudiant, :NEW.id_faculte);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
-- END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
-- /                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
-- ALTER TRIGGER INFO_ACCADEMIQUE_V_T ENABLE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  CREATE OR REPLACE EDITIONABLE TRIGGER NOTIF_I_TRIGGER AFTER INSERT ON inscription                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
FOR EACH ROW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
DECLARE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
v_specialite VARCHAR2(60);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    select specialite into v_specialite from master where id_master = :NEW.id_master;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
        INSERT INTO notif (id_notif, msg, notif_date, id_tag, readed, id_master, id_etudiant)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        VALUES(notif_seq.NEXTVAL,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
               'Vous etes inscrit avec succes au master "' || v_specialite ||'".',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                sysdate,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                1,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                'f',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                :NEW.id_master,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                :NEW.id_etudiant);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
ALTER TRIGGER NOTIF_I_TRIGGER ENABLE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  CREATE OR REPLACE EDITIONABLE TRIGGER NOTIF_P_TRIGGER AFTER INSERT ON preselection                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
FOR EACH ROW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
DECLARE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
v_specialite VARCHAR2(60);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
v_id_master number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
v_id_etudiant number;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    select id_master into v_id_master from inscription where id_Inscription = :NEW.id_Inscription;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    select id_etudiant into v_id_etudiant from inscription where id_Inscription = :NEW.id_Inscription;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
    select specialite into v_specialite from master where id_master = v_id_master;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
        INSERT INTO notif (id_notif, msg, notif_date, id_tag, readed, id_master, id_etudiant)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        VALUES(notif_seq.NEXTVAL,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
               'Felicitations ! Vous avez ete preselectionne pour participer au concours d''admission au master "' || v_specialite ||'".',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                sysdate,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                'f',                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                v_id_master,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                v_id_etudiant);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
ALTER TRIGGER NOTIF_P_TRIGGER ENABLE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           

--notif si on est appele pour passer le concours

-- liste finale notification
CREATE OR REPLACE TRIGGER notif_l_f_trigger AFTER INSERT ON Liste_Finale
FOR EACH ROW
DECLARE
v_specialite VARCHAR2(60);
v_id_master number;
v_id_etudiant number;
BEGIN
    select id_master into v_id_master from inscription where id_Inscription = :NEW.id_Inscription;
    select id_etudiant into v_id_etudiant from inscription where id_Inscription = :NEW.id_Inscription;
    select specialite into v_specialite from master where id_master = v_id_master;
        INSERT INTO notif (id_notif, msg, notif_date, id_tag, readed, id_master, id_etudiant) 
        VALUES(notif_seq.NEXTVAL,
               'Felicitations ! Vous etes sur la liste principale pour le concours d''admission au master "' || v_specialite ||'".',
                sysdate,
                3,
                'f',
                v_id_master,
                v_id_etudiant);
END;
/
-- liste attente notification

CREATE OR REPLACE TRIGGER notif_l_a_trigger AFTER INSERT ON Liste_Attente
FOR EACH ROW
DECLARE
v_specialite VARCHAR2(60);
v_id_master number;
v_id_etudiant number;
BEGIN
    select id_master into v_id_master from inscription where id_Inscription = :NEW.id_Inscription;
    select id_etudiant into v_id_etudiant from inscription where id_Inscription = :NEW.id_Inscription;
    select specialite into v_specialite from master where id_master = v_id_master;
        INSERT INTO notif (id_notif, msg, notif_date, id_tag, readed, id_master, id_etudiant) 
        VALUES(notif_seq.NEXTVAL,
               'Vous etes actuellement sur la liste d''attente pour le concours d''admission au master "' || v_specialite ||'".',
                sysdate,
                3,
                'f',
                v_id_master,
                v_id_etudiant);
END;
/


-- Convocation notification
CREATE OR REPLACE TRIGGER notif_conv_trigger AFTER INSERT ON convocation
FOR EACH ROW
DECLARE
v_specialite VARCHAR2(60);
v_id_master number;
v_id_etudiant number;
BEGIN
    select id_master into v_id_master from inscription where id_Inscription = :NEW.id_Inscription;
    select id_etudiant into v_id_etudiant from inscription where id_Inscription = :NEW.id_Inscription;
    select specialite into v_specialite from master where id_master = v_id_master;
        INSERT INTO notif (id_notif, msg, notif_date, id_tag, readed, id_master, id_etudiant) 
        VALUES(notif_seq.NEXTVAL,
               'Felicitations ! Vous avez ete transfere de la liste d''attente a la liste finale pour pour le concours d''admission au master "' || v_specialite ||'". Veuillez consulter votre bote mail pour plus d''informations.',
                sysdate,
                3,
                'f',
                v_id_master,
                v_id_etudiant);
END;
/



                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
  CREATE OR REPLACE EDITIONABLE TRIGGER INSCRIPTION_TR INSTEAD of INSERT on inscription_v                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
FOR Each row                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    INSERT into inscription(ID_INSCRIPTION, ID_MASTER, ID_ETUDIANT, d_inscription) VALUES(inscription_seq.NEXTVAL, :NEW.id_master, :NEW.id_Etudiant, sysdate);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          
END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
ALTER TRIGGER INSCRIPTION_TR ENABLE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
  CREATE OR REPLACE EDITIONABLE TRIGGER TRG_MASTER_AFTER_INSERT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
AFTER INSERT ON master                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
FOR EACH ROW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
BEGIN                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
    INSERT INTO master_tokenmap (token, id_master)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    VALUES (RAWTOHEX(SYS_GUID()), :NEW.id_master);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
END;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
ALTER TRIGGER TRG_MASTER_AFTER_INSERT ENABLE;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        


CREATE OR REPLACE TRIGGER before_insert_token
BEFORE INSERT ON ETUDIANT_TOKENMAP
FOR EACH ROW
DECLARE
    cnt INTEGER;
BEGIN
    -- Check if the idEtudiant already exists
    SELECT COUNT(*) INTO cnt FROM ETUDIANT_TOKENMAP WHERE id_etudiant = :NEW.id_etudiant;

    IF cnt > 0 THEN
        --delete the existing one
        delete from ETUDIANT_TOKENMAP where id_etudiant = :NEW.id_etudiant;
        
    END IF;
END;
--utilisation en MasterDaoImp addMaster(Master master)
create or replace TRIGGER ADD_MASTER_CONDITION INSTEAD of INSERT on MASTER_CONDITION_V
FOR EACH ROW
declare 
id_condition int;
BEGIN
    SELECT SQC_CONDITION.nextval INTO id_condition FROM dual;
    INSERT INTO condition values(
                                    id_condition,
                                    :NEW.MAX_AGE,
                                    :NEW.MAX_ANNEE_ETUDE,
                                    :NEW.NOTE_MIN_SEMESTRE,
                                    :NEW.NOTE_SEUIL
                                );
    INSERT INTO master values(
                                    :NEW.id_master,
                                    :NEW.SPECIALITE,
                                    upper(:NEW.NOM_COORDINATEUR),
                                    :NEW.D_DEBUT_INSCRIPTION,
                                    :NEW.D_FIN_INSCRIPTION,
                                    :NEW.D_AFF_PRESELECTION,
                                    :NEW.D_CONCOURS,
                                    :NEW.D_AFF_RESULTAT_CONCOURS,  
                                    :NEW.LIEU_CONCOURS,
                                    :NEW.INFORMATION,
                                    :NEW.ID_RESPONSABLE,
                                    id_condition
                                );                                
END;

--utilisation en addMaster pour ajouter les filieres admet en master dans la table FILIERE_ADMET_MASTER
create or replace trigger add_fAM 
INSTEAD of insert on MASTER_FILIER_ADMET_V 
FOR EACH ROW 
begin 
    INSERT into FILIERE_ADMET_MASTER
    values (
            SQC_FILIERE_ADMET_MASTER.nextval,
            :NEW.ID_MASTER,
            :NEW.ID_FIL_LICENCE
            );
end;





-- trigger pour gerer l'insertion dans la vue par les sequencs dja crs
CREATE OR REPLACE TRIGGER Etudiant_Info_insert_trigger
INSTEAD OF INSERT ON Etudiant_Info_insertion
FOR EACH ROW
DECLARE
    v_id_etudiant INT;
    v_id_ia INT;
BEGIN
    -- Get next sequence value for ID_ETUDIANT
    SELECT SEQ_ETUDIANT.NEXTVAL INTO v_id_etudiant FROM DUAL;

    -- Insert into Etudiant table
    INSERT INTO Etudiant (ID_ETUDIANT, NOM, PRENOM, D_NAISS, SEXE, TELE, EMAIL, PASSWORD, NATIONALITE, CIN, MASSAR)
    VALUES (v_id_etudiant, :NEW.NOM, :NEW.PRENOM, :NEW.D_NAISS, :NEW.SEXE, :NEW.TELE, :NEW.EMAIL, :NEW.PASSWORD, :NEW.NATIONALITE, :NEW.CIN, :NEW.MASSAR);

    -- Get next sequence value for ID_IA
    SELECT SEQ_INFO_ACAD.NEXTVAL INTO v_id_ia FROM DUAL;

    -- Insert into Info_academique table
    INSERT INTO Info_academique (ID_IA, D_LICENCE, D_BAC, FIL_BAC, MOY_LICENCE, MOY_BAC, N_S1, N_S2, N_S3, N_S4, N_S5, N_S6, DOCUMENT, PHOTO, ID_FIL_LICENCE, ID_ETUDIANT, ID_FACULTE)
    VALUES (v_id_ia, :NEW.D_LICENCE, :NEW.D_BAC, :NEW.FIL_BAC, :NEW.MOY_LICENCE, :NEW.MOY_BAC, :NEW.N_S1, :NEW.N_S2, :NEW.N_S3, :NEW.N_S4, :NEW.N_S5, :NEW.N_S6, :NEW.DOCUMENT, :NEW.PHOTO, :NEW.ID_FIL_LICENCE, v_id_etudiant, :NEW.ID_FACULTE);
END;

--trigger for delete master we delete filiere

create or replace trigger delete_master instead of delete  on MASTER_CARD_V 
for EACH ROW 
declare 
id_condition_v master.id_condition%type;
BEGIN
        DELETE FROM LISTE_FINALE 
        WHERE id_inscription in (SELECT id_inscription 
                                FROM inscription 
                                WHERE id_master = :old.ID_MASTER
                                );
        -- Delete from LISTE_ATTENTE 
        DELETE FROM LISTE_ATTENTE 
        WHERE id_inscription in (SELECT id_inscription 
                                FROM inscription 
                                WHERE id_master = :old.ID_MASTER
                                );
        DELETE FROM PRESELECTION 
        WHERE id_inscription in (SELECT id_inscription 
                                FROM inscription 
                                WHERE id_master = :old.ID_MASTER
                                );
        DELETE FROM inscription where id_master = :old.ID_MASTER;
        DELETE FROM FILIERE_ADMET_MASTER where id_master = :old.ID_MASTER;
        SELECT id_condition into id_condition_v from master where id_master = :old.ID_MASTER;
        delete FROM  master where id_master =:old.ID_MASTER;
        delete FROM CONDITION where id_condition = id_condition_v;
END;
--trigger to insert new students 
